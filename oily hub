local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- 创建主GUI函数
local function CreateGUI(title)
    -- 创建主GUI
    local gui = Instance.new("ScreenGui")
    gui.Name = "OilyHub"
    gui.ResetOnSpawn = false
    gui.DisplayOrder = 10
    gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

    -- 主框架
    local frame = Instance.new("Frame")
    frame.Name = "MainFrame"
    frame.BackgroundTransparency = 0
    frame.BackgroundColor3 = Color3.fromRGB(106, 159, 255)
    frame.BorderSizePixel = 0
    frame.Position = UDim2.new(0.3, 0, 0.3, 0)
    frame.Size = UDim2.new(0, 350, 0, 250)
    frame.Parent = gui

    -- 圆角
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = frame

    -- 拖动功能
    local dragging = false
    local startPos, startOffset

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            startPos = input.Position
            startOffset = frame.Position
            gui.Active = true
        end
    end)

    frame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
            gui.Active = false
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - startPos
            frame.Position = UDim2.new(
                startOffset.X.Scale, startOffset.X.Offset + delta.X,
                startOffset.Y.Scale, startOffset.Y.Offset + delta.Y
            )
        end
    end)

    -- 标题
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "TitleLabel"
    titleLabel.Size = UDim2.new(1, 0, 0.1, 0)
    titleLabel.Position = UDim2.new(0, 0, 0.01, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Color3.new(0, 143, 255)
    titleLabel.TextSize = 20
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.Parent = frame

    -- 关闭按钮
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -35, 0, 5)
    closeButton.BackgroundTransparency = 0
    closeButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.new(1, 1, 1)
    closeButton.TextSize = 18
    closeButton.Font = Enum.Font.GothamBold
    closeButton.Parent = frame

    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 5)
    closeCorner.Parent = closeButton

    -- 内容区域
    local contentFrame = Instance.new("Frame")
    contentFrame.Name = "ContentFrame"
    contentFrame.Size = UDim2.new(0.9, 0, 0.7, 0)
    contentFrame.Position = UDim2.new(0.05, 0, 0.15, 0)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Parent = frame

    -- 作者信息
    local authorLabel = Instance.new("TextLabel")
    authorLabel.Name = "AuthorLabel"
    authorLabel.Size = UDim2.new(1, 0, 0.2, 0)
    authorLabel.Position = UDim2.new(0, 0, 0.8, 0)
    authorLabel.BackgroundTransparency = 1
    authorLabel.Text = "作者: OliyOvO\nQQ: 1622103455"
    authorLabel.TextColor3 = Color3.new(1, 1, 1)
    authorLabel.TextSize = 14
    authorLabel.Font = Enum.Font.Gotham
    authorLabel.TextYAlignment = Enum.TextYAlignment.Top
    authorLabel.Parent = frame

    -- 确认按钮
    local confirmButton = Instance.new("TextButton")
    confirmButton.Name = "ConfirmButton"
    confirmButton.Size = UDim2.new(0.4, 0, 0.1, 0)
    confirmButton.Position = UDim2.new(0.3, 0, 0.65, 0)
    confirmButton.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
    confirmButton.Text = "确认使用"
    confirmButton.TextColor3 = Color3.new(1, 1, 1)
    confirmButton.TextSize = 16
    confirmButton.Font = Enum.Font.GothamBold
    confirmButton.Parent = frame

    local confirmCorner = Instance.new("UICorner")
    confirmCorner.CornerRadius = UDim.new(0, 5)
    confirmCorner.Parent = confirmButton

    -- 按钮功能
    closeButton.MouseButton1Click:Connect(function()
        gui:Destroy()
    end)

    confirmButton.MouseButton1Click:Connect(function()
        gui:Destroy()
        LoadMainScript()
    end)

    return gui
end

-- 加载主脚本函数
local function LoadMainScript()
    -- 加载外部库
    local success, library = pcall(function()
        return loadstring(game:HttpGet("https://pastebin.com/raw/3vQbADjh"))()
    end)

    if not success then
        warn("无法加载库: ", library)
        return
    end

    -- 创建主窗口
    local window = library:new("Oily Hub V2")

    -- 关于标签
    local aboutTab = window:Tab("关于", "6031097229")
    local aboutSection = aboutTab:section("信息", true)
    aboutSection:Label("Oliy制作")
    aboutSection:Label("帮助者: hfh916")
    aboutSection:Label("作者QQ: 1622103455")
    aboutSection:Label("发布日期: 2025年8月18号")

    -- 通用功能标签
    local generalTab = window:Tab("通用功能", "6035145364")
    local generalSection = generalTab:section("玩家设置", true)

    -- 通用功能
    generalSection:Slider("步行速度", "WalkSpeed", 16, 16, 400, function(value)
        LocalPlayer.Character:WaitForChild("Humanoid").WalkSpeed = value
    end)

    generalSection:Slider("跳跃高度", "JumpPower", 50, 50, 400, function(value)
        LocalPlayer.Character:WaitForChild("Humanoid").JumpPower = value
    end)

    generalSection:Toggle("夜视", "NightVision", false, function(state)
        if state then
            game.Lighting.Ambient = Color3.new(1, 1, 1)
        else
            game.Lighting.Ambient = Color3.new(0, 0, 0)
        end
    end)

    -- 其他功能标签
    local otherTab = window:Tab("其他功能", "6035145364")
    local otherSection = otherTab:section("脚本", true)

    otherSection:Button("飞行脚本", function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/XNEOFF/FlyGuiV3/main/FlyGuiV3.txt"))()
    end)

    otherSection:Button("穿墙", function()
        loadstring(game:HttpGet("https://pastebin.com/raw/zXk4Rq2r"))()
    end)

    otherSection:Button("无限跳跃", function()
        loadstring(game:HttpGet("https://pastebin.com/raw/V5PQy3y0"))()
    end)

    -- 添加更多功能...
end

-- 初始化GUI
CreateGUI("Oily Hub V2")
